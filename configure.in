dnl Process this file with autoconf to produce a configure script.

AC_INIT(configure.in)
AM_INIT_AUTOMAKE(sodipodi, 0.19)
AM_CONFIG_HEADER(config.h)

dnl Pick up the Gnome macros.
AM_ACLOCAL_INCLUDE(macros)

GNOME_INIT
AC_ISC_POSIX
AC_PROG_CC
AM_PROG_CC_STDC
AC_HEADER_STDC

GNOME_COMPILE_WARNINGS
GNOME_X_CHECKS
GNOME_XML_CHECK

GNOME_PRINT_CHECK
AC_CHECK_HEADER(libgnomeprint/gnome-print-frgba.h,AC_DEFINE(ENABLE_FRGBA))
AC_CHECK_HEADER(libgnomeprint/gnome-print-rbuf.h,AC_DEFINE(ENABLE_RBUF))
AC_CHECK_HEADER(libgnomeprint/gnome-font-face.h,AC_DEFINE(NEW_FONT_MODEL))

dnl Add the languages which your application supports here.
ALL_LINGUAS="da de et ga no ru sl sv tr uk"
AM_GNU_GETTEXT

dnl Set PACKAGE_LOCALE_DIR in config.h.
if test "x${prefix}" = "xNONE"; then
  AC_DEFINE_UNQUOTED(PACKAGE_LOCALE_DIR, "${ac_default_prefix}/${DATADIRNAME}/locale")
else
  AC_DEFINE_UNQUOTED(PACKAGE_LOCALE_DIR, "${prefix}/${DATADIRNAME}/locale")
fi

dnl ******************************
dnl Check for Bonobo
dnl ******************************
try_bonobo=true
have_bonobo=false
AC_ARG_WITH(bonobo,
	[--{with,without}-bonobo Compile with Bonobo support or without it],
	if test x$withval = xno; then
		try_bonobo=false
	fi
)

if $try_bonobo; then
	AC_MSG_CHECKING(for Bonobo >= 0.17)
	if $GNOME_CONFIG --libs bonobox_print > /dev/null 2>&1; then
		vers=`$GNOME_CONFIG --modversion bonobo | sed -e "s/bonobo-//" | \
			awk 'BEGIN { FS = "."; } { print $1 * 1000 + $2;}'`
		if test "$vers" -ge 17; then
			bonobo_ok=true
		else
			bonobo_ok=false
		fi
	else
		bonobo_ok=false
	fi

	if $bonobo_ok; then
		AC_MSG_RESULT(found)
		AC_DEFINE(ENABLE_BONOBO)
		have_bonobo=true
		EXTRA_BONOBO_GNOME_LIBS=`$GNOME_CONFIG --libs bonobox_print`
		EXTRA_BONOBO_GNOME_CFLAGS=`$GNOME_CONFIG --cflags bonobox_print`

		dnl Check if Bonobo is OAFized

		AC_MSG_CHECKING(if Bonobo uses OAF)
		if ( gnome-config --libs bonobo | grep oaf ) > /dev/null 2>&1 ; then
			using_oaf="yes"
			AC_DEFINE(USING_OAF)
		else
			using_oaf="no"
		fi

		AC_MSG_RESULT("$using_oaf")

		AM_CONDITIONAL(USING_OAF, test x"using_oaf" = "xyes")
	else    
		AC_MSG_RESULT(not found)
		EXTRA_BONOBO_GNOME_LIBS=
		EXTRA_BONOBO_GNOME_CFLAGS=
	fi
fi

AM_CONDITIONAL(BONOBO, $have_bonobo)
AC_SUBST(EXTRA_BONOBO_GNOME_CFLAGS)
AC_SUBST(EXTRA_BONOBO_GNOME_LIBS)

dnl ******************************
dnl GnomePrint checking
dnl ******************************
AC_MSG_CHECKING(for GnomePrint libraries >= 0.21)
if gnome-config --libs print > /dev/null 2>&1; then
vers=`gnome-config --modversion print | sed -e "s/gnome-print-//" -e 's/cvs$//' | \
        awk 'BEGIN { FS = "."; } { print $1 * 1000 + $2;}'`
    if test "$vers" -ge 21; then
        AC_MSG_RESULT(found)
    else
         AC_MSG_ERROR(You need at least GNOME print 0.21 for this version of sodipodi)
    fi
else
    AC_MSG_ERROR(Did not find GnomePrint installed)
fi

AC_OUTPUT([
Makefile
macros/Makefile
src/Makefile
src/xml/Makefile
src/svg/Makefile
src/helper/Makefile
src/dialogs/Makefile
src/display/Makefile
src/bonobo/Makefile
glade/Makefile
intl/Makefile
po/Makefile.in
sodipodi.spec
])
